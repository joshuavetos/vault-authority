# Stage 1: Build
FROM rust:1.75-slim as builder
WORKDIR /app
COPY . .
RUN cargo build --release

# Stage 2: Hardened Runtime
FROM debian:bookworm-slim
WORKDIR /app
COPY --from=builder /app/target/release/vault-authority .
COPY --from=builder /app/playbook.yaml .
COPY --from=builder /app/playbooks/ ./playbooks/

# Production Environment Variables
ENV RUST_LOG=info
EXPOSE 8080

CMD ["./vault-authority", "--server"]
